# Aegonish Blog ‚Äì Fresh‚ÄëStart Guide

This repository contains a Kubernetes‚Äëbased deployment of the Aegonish blog application using **Helm**, **Argo‚ÄØCD**, and **Nginx Ingress**. The steps below let you spin up the whole stack from a clean machine.

---

## Prerequisites
- **Docker Desktop** (with Kubernetes enabled) or any Docker engine.
- **k3d** ‚Äì lightweight K3s cluster (`choco install k3d` or the official script).
- **kubectl** (`choco install kubernetes-cli`).
- **helm** (`choco install kubernetes-helm`).
- **git**.
- (Optional) **Argo‚ÄØCD CLI** (`choco install argocd`).

---

## 1Ô∏è‚É£ Create a local Kubernetes cluster
```powershell
k3d cluster create aegonish \
  --port "80:80@loadbalancer" \
  --port "443:443@loadbalancer" \
  --agents 2
```
The `--port` flags expose HTTP/HTTPS on the host so the Ingress can be reached.

---

## 2Ô∏è‚É£ Clone the repo & enter the project
```powershell
git clone https://github.com/aegonish/aegonish-local.git
cd aegonish-local
```

---

## 3Ô∏è‚É£ Prepare namespace & Docker registry secret (if needed)
```powershell
kubectl create namespace aegonish
# If you push images to a private registry, create the secret:
# kubectl create secret docker-registry dockerhub-creds \
#   --docker-username=<USER> \
#   --docker-password=<PASS> \
#   --docker-server=<SERVER> -n aegonish
```

---

## 4Ô∏è‚É£ Build & push Docker images
```powershell
# Frontend
cd aegonish-blog/aegonish-frontend
docker build -t <registry>/aegonish-frontend:latest .
docker push <registry>/aegonish-frontend:latest

# Backend
cd ../backend
docker build -t <registry>/aegonish-backend:latest .
docker push <registry>/aegonish-backend:latest

cd ../../..
```
Update `helm-local/aegonish-blog/values.yaml` if you used a different repository/tag.

---

## 5Ô∏è‚É£ Install the Nginx Ingress controller (Helm)
```powershell
helm repo add ingress-nginx https://kubernetes.github.io/ingress-nginx
helm repo update
helm upgrade --install ingress-nginx ingress-nginx/ingress-nginx \
  --namespace ingress-nginx --create-namespace \
  --set controller.service.type=NodePort
```
The controller will expose a NodePort (e.g., `30279`).

---

## 6Ô∏è‚É£ Deploy the application via Argo‚ÄØCD (or Helm directly)
### Using Argo‚ÄØCD
```powershell
kubectl apply -f manifests/argocd/application.yaml
```
Argo‚ÄØCD will sync the Helm chart located at `helm-local/aegonish-blog` into the `aegonish` namespace.

### Or manual Helm install (skip Argo‚ÄØCD)
```powershell
helm dependency build helm-local/aegonish-blog
helm upgrade --install aegonish-blog ./helm-local/aegonish-blog -n aegonish
```

---

## 7Ô∏è‚É£ Verify resources are up
```powershell
kubectl get all -n aegonish
kubectl get ingress -n aegonish
kubectl get svc -n ingress-nginx
```
You should see the `frontend`, `backend`, `mongo` pods, the `aegonish-ingress` with rules for `/`, `/api`, `/uploads`, and the `ingress-nginx-controller` Service with a NodePort (e.g., `30279`).

---

## 8Ô∏è‚É£ Expose the Ingress to your browser
Pick a free high‚Äërange local port (5000‚Äë5999 are safe) and forward it:
```powershell
kubectl port-forward svc/ingress-nginx-controller -n ingress-nginx 5111:80
```
Now open the app:
- **http://localhost:5111** ‚Äì home page
- (Optional) add a hosts entry for a nicer URL:
  ```powershell
  Add-Content -Path "$env:SystemRoot\System32\drivers\etc\hosts" "`n127.0.0.1 aegonish.local"
  ```
  Then you can also use **http://aegonish.local:5111**.

---

## 9Ô∏è‚É£ Test the upload flow
1. Open the UI in the browser.
2. Click **Upload**, fill title/content, select an image, and submit.
3. The request goes through the Ingress (`/api/upload`) ‚Üí backend ‚Üí Google Drive (credentials are injected via a ConfigMap).
4. Verify the new post appears on the home page and the image URL points to Google Drive.

---

## üéâ All set!
You now have a reproducible, dev‚Äëops‚Äëfriendly deployment of the Aegonish blog that can be started from a fresh clone with the steps above.

---

*Generated by Antigravity ‚Äì your AI coding assistant.*
